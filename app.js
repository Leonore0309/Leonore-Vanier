/* ========= I18N : dictionnaire FR/EN ========= */
const I18N = {
  fr: {
    "contact.inline": "Tél : 06 79 10 75 93 • Email : leonore.vanier@gmail.com • Paris, Île-de-France • 170 cm",

    "section.photos": "Photos",
    "nav.bio": "Bio",
    "section.casting": "Informations casting",
    "toggle.more": "Afficher plus",
    "toggle.less": "Afficher moins",
    "section.theatre": "Théâtre",
    "section.films": "Cinéma – Courts métrages",
    "section.tv": "Télévision",
    "section.training": "Formations",
    "section.reel": "Bande démo",

    "reel.open": "Lire la bande démo",
    "reel.cover": "Bande démo — miniature locale",

    "bio.quote": "\"Invente, imagine, suppose. Fouille dans ton esprit. Cherches-y quelque chose d’étrange, d’insensé, d’horrible et d’inouï. Une fatalité dont on soit ébloui !\" [Ruy Blas, Victor Hugo]",

    "casting.langues.k": "Langues",
    "casting.langues.v": "Anglais (bilingue sans accent), Espagnol (avancé), Coréen, Italien (notions), Français (maternelle)",
    "casting.danses.k": "Danses",
    "casting.danses.v": "Pompons girls (compétition), Classique (très bon niveau), Modern’Jazz (bon niveau)",
    "casting.musique.k": "Musique",
    "casting.musique.v": "Chant (Alto)",
    "casting.sport.k": "Sport",
    "casting.sport.v": "Athlétisme (semi-marathon), Ski (très bon niveau), Natation (bon niveau), Karaté (bon niveau)",
    "casting.hobbies.k": "Hobbies",
    "casting.hobbies.v": "Couture, Poterie, Modèle photo",
    "casting.permis.k": "Permis",
    "casting.permis.v": "B",

    "theatre.item1": "LE BAIN – Mise en scène Clara Kermarec – Théâtre de La Croisée des Chemins – Rôle principal - Sélection \"Festival Travaux de Fin d'Etudes Cours Florent 25/26\"",
    "theatre.item2": "TRISTESSE ET JOIE DANS LA VIE DES GIRAFES – Mise en scène Iona Vavasseur – Rôle Judy Garland",
    "theatre.item3": "LE LEGS – Mise en scène Alain de Bock – Théâtre A LA FOLIE - Rôle d'Hortense",
    "theatre.item4": "LE MARIAGE DE FIGARO – Mise en scène Sophie Lecarpentier – Rôle La Comtesse",
    "theatre.item5": "LA BONNE ÂME DU SE-TCHOUAN – Mise en scène Xavier Bazin – Rôle La Femme",
    "theatre.item6": "RING – Mise en scène Frédérique Auger – Théâtre Clavel – Rôle La Femme",

    "films.item1": "J’EN TROUVERAI UN AUTRE – Réal. Louis Faudais – Rôle principal (comédie) - Sélection \"1 min 2 court Festival\"",
    "films.item2": "LE DAHUT – Réal. Léonore Vanier – Rôle principal (comédie) - Sélection \"Prix Florent Image\"",
    "films.item3": "MASTERPROF – Réal. Jef Yomby – Opango – Rôle principal (comédie)",

    "tv.item1": "VINCI AUTOROUTE – Réal. Charly – Prod. Marie Gleyze & Sylvain Pouyet – Rôle principal",
    "tv.item2": "ENGIE Solutions – Réal. 714 Prod – Rôle principal",

    "training.item1": "Stage « Intitation à la transe » (Valérie De Dietrich) — Stage Systema (Laurent Joly) — Atelier coaching (Fabrice Luneau) — Open Badge : prévenir et lutter contre les VHSS dans le cinéma",
    "training.item2": "Cours Florent : Année 3 (Jerzy Klsyk, Sandy Boizard, Sophie Lecarpentier) — Stage Masque (Khadija El Mahdi) — Stage Impro (David Garel) — Stage casting (Emmanuelle Bourcy)",
    "training.item3": "Cours Florent : Année 2 (Xavier Bazin)",
    "training.item4": "Cours Florent : Année 1 (Olivier Augrond)",
    "training.item5": "Diplôme d’ingénieur, National University of Singapore",

    "photos.epoque": "Époque",
    "photos.innocence": "Innocence",
    "photos.fatale": "Fatale",
    "photos.malice": "Malice",
    "photos.romantique": "Romantique",
    "photos.dynamique": "Dynamique",
    "photos.puissante": "Puissante",
    "photos.douceur": "Douceur",
    "photos.heroine_romantique": "Héroïne romantique",
    "photos.heroine_epoque": "Héroïne romantique époque",
    "photos.jeune_flic": "Jeune flic"
  },

  en: {
    "contact.inline": "Phone: +33 6 79 10 75 93 • Email: leonore.vanier@gmail.com • Paris, Île-de-France • 170 cm",

    "section.photos": "Photos",
    "nav.bio": "Bio",
    "section.casting": "Casting info",
    "toggle.more": "Show more",
    "toggle.less": "Show less",
    "section.theatre": "Theatre",
    "section.films": "Short films",
    "section.tv": "Television",
    "section.training": "Training",
    "section.reel": "Showreel",

    "reel.open": "Play the showreel",
    "reel.cover": "Showreel — local thumbnail",

    "bio.quote": "\"Invent, imagine, suppose. Search your mind for something strange, outrageous, terrible, unheard of! A dazzling twist of fate!\" [Ruy Blas, Victor Hugo]",

    "casting.langues.k": "Languages",
    "casting.langues.v": "English (fluent, no accent), Spanish (advanced), Korean, Italian (basic), French (native)",
    "casting.danses.k": "Dance",
    "casting.danses.v": "Cheer dance (competition), Ballet (very good), Modern Jazz (good)",
    "casting.musique.k": "Music",
    "casting.musique.v": "Singing (Alto)",
    "casting.sport.k": "Sports",
    "casting.sport.v": "Athletics (half-marathon), Skiing (very good), Swimming (good), Karate (good)",
    "casting.hobbies.k": "Hobbies",
    "casting.hobbies.v": "Sewing, Pottery, Photo model",
    "casting.permis.k": "Driving license",
    "casting.permis.v": "B",

    "theatre.item1": "LE BAIN – Dir. Clara Kermarec – Théâtre de La Croisée des Chemins – Lead role – Selected \"Festival Travaux de Fin d'Etudes Cours Florent 25/26\"",
    "theatre.item2": "TRISTESSE ET JOIE DANS LA VIE DES GIRAFES – Dir. Iona Vavasseur – Role: Judy Garland",
    "theatre.item3": "LE LEGS – Dir. Alain de Bock – Théâtre A LA FOLIE – Role: Hortense",
    "theatre.item4": "LE MARIAGE DE FIGARO – Dir. Sophie Lecarpentier – Role: The Countess",
    "theatre.item5": "LA BONNE ÂME DU SE-TCHOUAN – Dir. Xavier Bazin – Role: Woman",
    "theatre.item6": "RING – Dir. Frédérique Auger – Théâtre Clavel – Role: Woman",

    "films.item1": "J'EN TROUVERAI UN AUTRE – Dir. Louis Faudais – Lead (comedy) – Selected \"1 min 2 court Festival\"",
    "films.item2": "LE DAHUT – Dir. Léonore Vanier – Lead (comedy) – Selected \"Prix Florent Image\"",
    "films.item3": "MASTERPROF – Dir. Jef Yomby – Opango – Lead (comedy)",

    "tv.item1": "VINCI AUTOROUTE – Dir. Charly – Prod. Marie Gleyze & Sylvain Pouyet – Lead",
    "tv.item2": "ENGIE Solutions – Dir. 714 Prod – Lead",

    "training.item1": "2025 – \"Initiation to trance\" (Valérie De Dietrich) — Systema (Laurent Joly) — Coaching workshop (Fabrice Luneau) — VHSS badge",
    "training.item2": "2024-25 – Cours Florent: Year 3 (Jerzy Klsyk, Sandy Boizard, Sophie Lecarpentier) — Mask (Khadija El Mahdi) — Improv (David Garel) — Casting (Emmanuelle Bourcy)",
    "training.item3": "2023-24 – Cours Florent: Year 2 (Xavier Bazin)",
    "training.item4": "2022-23 – Cours Florent: Year 1 (Olivier Augrond)",
    "training.item5": "2022 – Engineering degree, National University of Singapore",

    "photos.epoque": "Period",
    "photos.innocence": "Innocence",
    "photos.fatale": "Femme fatale",
    "photos.malice": "Mischief",
    "photos.romantique": "Romantic",
    "photos.dynamique": "Dynamic",
    "photos.puissante": "Powerful",
    "photos.douceur": "Softness",
    "photos.heroine_romantique": "Romantic heroine",
    "photos.heroine_epoque": "Period romantic heroine",
    "photos.jeune_flic": "Young cop"
  }
};

/* ========= i18n : applique langue ========= */
function setLang(lang){
  localStorage.setItem('lang', lang);
  document.documentElement.setAttribute('lang', lang);

  // Textes simples
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    const text = I18N[lang]?.[key];
    if (typeof text === 'string') el.textContent = text;
  });

  // Attributs (ex: alt, aria-label) via data-i18n-attr="alt:key;aria-label:key2"
  document.querySelectorAll('[data-i18n-attr]').forEach(el=>{
    const defs = el.getAttribute('data-i18n-attr')
      .split(';').map(s=>s.trim()).filter(Boolean);
    defs.forEach(pair=>{
      const [attr, key] = pair.split(':').map(s=>s.trim());
      const val = I18N[lang]?.[key];
      if (attr && typeof val === 'string') el.setAttribute(attr, val);
    });
  });

  // Boutons FR/EN
  document.querySelectorAll('.lang-btn').forEach(btn=>{
    btn.setAttribute('aria-pressed', String(btn.dataset.lang === lang));
  });

  // Met à jour le libellé du toggle casting
  const list = document.getElementById('casting-list');
  const toggle = document.querySelector('.toggle-casting');
  if (list && toggle){
    const expanded = list.classList.contains('expanded');
    const tkey = expanded ? 'toggle.less' : 'toggle.more';
    toggle.textContent = I18N[lang][tkey] || toggle.textContent;
  }
}

/* ========= Casting : clamp + toggle ========= */
function initCastingClamp(){
  const list = document.getElementById('casting-list');
  if(!list) return;
  const rows = Array.from(list.querySelectorAll('.kv'));
  const toggle = document.querySelector('.toggle-casting');

  function apply(){
    const expanded = list.classList.contains('expanded');
    rows.forEach((row, i)=>{
      row.style.display = (expanded || i < 3) ? 'grid' : 'none';
    });
    const lang = localStorage.getItem('lang') || 'fr';
    toggle.textContent = I18N[lang]['toggle.'+(expanded?'less':'more')] || toggle.textContent;
  }

  if (toggle){
    toggle.addEventListener('click', (e)=>{
      e.preventDefault();
      list.classList.toggle('expanded');
      apply();
    });
  }
  apply();
}

/* ========= Lightbox ========= */
function initLightbox(){
  const links = Array.from(document.querySelectorAll('.gallery a'));
  if(!links.length) return;

  const lb = document.getElementById('lightbox');
  const img = document.getElementById('lb-img');
  const cap = document.getElementById('lb-caption');
  const btnPrev = lb.querySelector('.lb-prev');
  const btnNext = lb.querySelector('.lb-next');
  const btnClose = lb.querySelector('.lb-close');
  let idx = 0;

  const srcOf = (i)=> {
    const a = links[i];
    return a.getAttribute('href') || (a.querySelector('img') && a.querySelector('img').src);
  };
  const altOf = (i)=> {
    const im = links[i].querySelector('img');
    return (im && im.getAttribute('alt')) || '';
  };

  function open(i){ idx = i; update(); lb.classList.add('open'); lb.setAttribute('aria-hidden','false'); document.body.classList.add('lb-open'); }
  function close(){ lb.classList.remove('open'); lb.setAttribute('aria-hidden','true'); document.body.classList.remove('lb-open'); }
  function update(){ img.src = srcOf(idx); img.alt = altOf(idx); cap.textContent = img.alt || ''; }
  function next(){ idx = (idx + 1) % links.length; update(); }
  function prev(){ idx = (idx - 1 + links.length) % links.length; update(); }

  links.forEach((a,i)=>{
    a.addEventListener('click', (e)=>{ e.preventDefault(); open(i); });
  });
  btnNext.addEventListener('click', (e)=>{ e.stopPropagation(); next(); });
  btnPrev.addEventListener('click', (e)=>{ e.stopPropagation(); prev(); });
  btnClose.addEventListener('click', (e)=>{ e.stopPropagation(); close(); });

  document.addEventListener('keydown', (e)=>{
    if(!lb.classList.contains('open')) return;
    if(e.key === 'Escape') return close();
    if(e.key === 'ArrowRight') return next();
    if(e.key === 'ArrowLeft') return prev();
  });

  lb.addEventListener('click', (e)=>{
    if(e.target === lb){ close(); }
  });
}

/* ========= Init global ========= */
document.addEventListener('DOMContentLoaded', ()=>{
  // Année auto
  const yearEl = document.getElementById('year');
  if (yearEl) yearEl.textContent = new Date().getFullYear();

  // Langue initiale
  const saved = localStorage.getItem('lang') || 'fr';
  setLang(saved);

  // Boutons de langue
  document.querySelectorAll('.lang-btn').forEach(btn=>{
    btn.addEventListener('click', ()=> setLang(btn.dataset.lang));
  });

  // Modules
  initCastingClamp();
  initLightbox();
});
// Charge html2canvas si absent (fallback CDN)
function ensureHtml2Canvas() {
  return new Promise((resolve, reject) => {
    if (window.html2canvas) return resolve();
    const s = document.createElement('script');
    s.src = 'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
    s.onload = () => window.html2canvas ? resolve() : reject(new Error('html2canvas introuvable après chargement'));
    s.onerror = () => {
      const s2 = document.createElement('script');
      s2.src = 'https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js';
      s2.onload = () => window.html2canvas ? resolve() : reject(new Error('html2canvas introuvable (fallback)'));
      s2.onerror = () => reject(new Error('Impossible de charger html2canvas (tous les CDNs)'));
      document.head.appendChild(s2);
    };
    document.head.appendChild(s);
  });
}

// ====== Export PDF A4 (html2pdf.js) ======
(function initPDF(){
  const btn = document.getElementById('download-snap');
  if (!btn) return;

  btn.addEventListener('click', async () => {
    try {
      // 1) attendre les polices (sinon le titre peut "sauter")
      if (document.fonts && document.fonts.ready) {
        await document.fonts.ready;
      }

      // 2) zone à capturer : tout le body => inclut le header (nom/prénom) + les photos
      const source = document.body; // ou document.querySelector('#pdf-root') si tu crées un wrapper

      // 3) options A4 + qualité/performances
      const year = new Date().getFullYear();
      const filename = `CV artistique Léonore Vanier - 06 79 10 75 93 - ${year}.pdf`;

      const opt = {
        margin:       10,                        // mm
        filename,
        image:        { type: 'jpeg', quality: 0.95 },
        html2canvas:  {
          backgroundColor: '#ffffff',
          useCORS: true,
          scale: window.devicePixelRatio > 1 ? 1.8 : 1.2, // ↓ si c'est lent : mets 1.2~1.5
          scrollX: 0, scrollY: -window.scrollY
        },
        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
        pagebreak:    { mode: ['avoid-all', 'css', 'legacy'] } // évite de couper en plein titre/image si possible
      };

      // 4) lancer la génération + téléchargement
      await html2pdf().set(opt).from(source).save();

    } catch (err) {
      console.error('Erreur PDF:', err);
      alert("Le PDF n'a pas pu être généré.");
    }
  });
})();

