/* ========= I18N : dictionnaire FR/EN ========= */
const I18N = {
  fr: {
    "contact.inline": "T√©l : 06 79 10 75 93 ‚Ä¢ Email : leonore.vanier@gmail.com ‚Ä¢ Paris, √éle-de-France ‚Ä¢ 170 cm",

    "section.photos": "Photos",
    "nav.bio": "Bio",
    "section.casting": "Informations casting",
    "toggle.more": "Afficher plus",
    "toggle.less": "Afficher moins",
    "section.theatre": "Th√©√¢tre",
    "section.films": "Cin√©ma ‚Äì Courts m√©trages",
    "section.tv": "T√©l√©vision",
    "section.training": "Formations",
    "section.reel": "Bande d√©mo",

    "reel.open": "Lire la bande d√©mo",
    "reel.cover": "Bande d√©mo ‚Äî miniature locale",

    "bio.quote": "\"Invente, imagine, suppose. Fouille dans ton esprit. Cherches-y quelque chose d‚Äô√©trange, d‚Äôinsens√©, d‚Äôhorrible et d‚Äôinou√Ø. Une fatalit√© dont on soit √©bloui !\" [Ruy Blas, Victor Hugo]",

    "casting.langues.k": "Langues",
    "casting.langues.v": "Anglais (bilingue sans accent), Espagnol (avanc√©), Cor√©en, Italien (notions), Fran√ßais (maternelle)",
    "casting.danses.k": "Danses",
    "casting.danses.v": "Pompons girls (comp√©tition), Classique (tr√®s bon niveau), Modern‚ÄôJazz (bon niveau)",
    "casting.musique.k": "Musique",
    "casting.musique.v": "Chant (Alto)",
    "casting.sport.k": "Sport",
    "casting.sport.v": "Athl√©tisme (semi-marathon), Ski (tr√®s bon niveau), Natation (bon niveau), Karat√© (bon niveau)",
    "casting.hobbies.k": "Hobbies",
    "casting.hobbies.v": "Couture, Poterie, Mod√®le photo",
    "casting.permis.k": "Permis",
    "casting.permis.v": "B",

    "theatre.item1": "LE BAIN ‚Äì Mise en sc√®ne Clara Kermarec ‚Äì Th√©√¢tre de La Crois√©e des Chemins ‚Äì R√¥le principal - S√©lection \"Festival Travaux de Fin d'Etudes Cours Florent 25/26\"",
    "theatre.item2": "TRISTESSE ET JOIE DANS LA VIE DES GIRAFES ‚Äì Mise en sc√®ne Iona Vavasseur ‚Äì R√¥le Judy Garland",
    "theatre.item3": "LE LEGS ‚Äì Mise en sc√®ne Alain de Bock ‚Äì Th√©√¢tre A LA FOLIE - R√¥le d'Hortense",
    "theatre.item4": "LE MARIAGE DE FIGARO ‚Äì Mise en sc√®ne Sophie Lecarpentier ‚Äì R√¥le La Comtesse",
    "theatre.item5": "LA BONNE √ÇME DU SE-TCHOUAN ‚Äì Mise en sc√®ne Xavier Bazin ‚Äì R√¥le La Femme",
    "theatre.item6": "RING ‚Äì Mise en sc√®ne Fr√©d√©rique Auger ‚Äì Th√©√¢tre Clavel ‚Äì R√¥le La Femme",

    "films.item1": "J‚ÄôEN TROUVERAI UN AUTRE ‚Äì R√©al. Louis Faudais ‚Äì R√¥le principal (com√©die) - S√©lection \"1 min 2 court Festival\"",
    "films.item2": "LE DAHUT ‚Äì R√©al. L√©onore Vanier ‚Äì R√¥le principal (com√©die) - S√©lection \"Prix Florent Image\"",
    "films.item3": "MASTERPROF ‚Äì R√©al. Jef Yomby ‚Äì Opango ‚Äì R√¥le principal (com√©die)",

    "tv.item1": "VINCI AUTOROUTE ‚Äì R√©al. Charly ‚Äì Prod. Marie Gleyze & Sylvain Pouyet ‚Äì R√¥le principal",
    "tv.item2": "ENGIE Solutions ‚Äì R√©al. 714 Prod ‚Äì R√¥le principal",

    "training.item1": "Stage ¬´ Intitation √† la transe ¬ª (Val√©rie De Dietrich) ‚Äî Stage Systema (Laurent Joly) ‚Äî Atelier coaching (Fabrice Luneau) ‚Äî Open Badge : pr√©venir et lutter contre les VHSS dans le cin√©ma",
    "training.item2": "Cours Florent : Ann√©e 3 (Jerzy Klsyk, Sandy Boizard, Sophie Lecarpentier) ‚Äî Stage Masque (Khadija El Mahdi) ‚Äî Stage Impro (David Garel) ‚Äî Stage casting (Emmanuelle Bourcy)",
    "training.item3": "Cours Florent : Ann√©e 2 (Xavier Bazin)",
    "training.item4": "Cours Florent : Ann√©e 1 (Olivier Augrond)",
    "training.item5": "Dipl√¥me d‚Äôing√©nieur, National University of Singapore",

    "photos.epoque": "√âpoque",
    "photos.innocence": "Innocence",
    "photos.fatale": "Fatale",
    "photos.malice": "Malice",
    "photos.romantique": "Romantique",
    "photos.dynamique": "Dynamique",
    "photos.puissante": "Puissante",
    "photos.douceur": "Douceur",
    "photos.heroine_romantique": "H√©ro√Øne romantique",
    "photos.heroine_epoque": "H√©ro√Øne romantique √©poque",
    "photos.jeune_flic": "Jeune flic"
  },

  en: {
    "contact.inline": "Phone: +33 6 79 10 75 93 ‚Ä¢ Email: leonore.vanier@gmail.com ‚Ä¢ Paris, √éle-de-France ‚Ä¢ 170 cm",

    "section.photos": "Photos",
    "nav.bio": "Bio",
    "section.casting": "Casting info",
    "toggle.more": "Show more",
    "toggle.less": "Show less",
    "section.theatre": "Theatre",
    "section.films": "Short films",
    "section.tv": "Television",
    "section.training": "Training",
    "section.reel": "Showreel",

    "reel.open": "Play the showreel",
    "reel.cover": "Showreel ‚Äî local thumbnail",

    "bio.quote": "\"Invent, imagine, suppose. Search your mind for something strange, outrageous, terrible, unheard of! A dazzling twist of fate!\" [Ruy Blas, Victor Hugo]",

    "casting.langues.k": "Languages",
    "casting.langues.v": "English (bilingual, no accent), Spanish (advanced), Korean, Italian (basic), French (native)",
    "casting.danses.k": "Dance",
    "casting.danses.v": "Cheer dance (competition), Ballet (very good), Modern Jazz (good)",
    "casting.musique.k": "Music",
    "casting.musique.v": "Singing (Alto)",
    "casting.sport.k": "Sports",
    "casting.sport.v": "Athletics (half-marathon), Skiing (very good), Swimming (good), Karate (good)",
    "casting.hobbies.k": "Hobbies",
    "casting.hobbies.v": "Sewing, Pottery, Photo model",
    "casting.permis.k": "Driving license",
    "casting.permis.v": "B",

    "theatre.item1": "LE BAIN ‚Äì Dir. Clara Kermarec ‚Äì Th√©√¢tre de La Crois√©e des Chemins ‚Äì Lead role ‚Äì Selected \"Festival Travaux de Fin d'Etudes Cours Florent 25/26\"",
    "theatre.item2": "TRISTESSE ET JOIE DANS LA VIE DES GIRAFES ‚Äì Dir. Iona Vavasseur ‚Äì Role: Judy Garland",
    "theatre.item3": "LE LEGS ‚Äì Dir. Alain de Bock ‚Äì Th√©√¢tre A LA FOLIE ‚Äì Role: Hortense",
    "theatre.item4": "LE MARIAGE DE FIGARO ‚Äì Dir. Sophie Lecarpentier ‚Äì Role: The Countess",
    "theatre.item5": "LA BONNE √ÇME DU SE-TCHOUAN ‚Äì Dir. Xavier Bazin ‚Äì Role: Woman",
    "theatre.item6": "RING ‚Äì Dir. Fr√©d√©rique Auger ‚Äì Th√©√¢tre Clavel ‚Äì Role: Woman",

    "films.item1": "J'EN TROUVERAI UN AUTRE ‚Äì Dir. Louis Faudais ‚Äì Lead (comedy) ‚Äì Selected \"1 min 2 court Festival\"",
    "films.item2": "LE DAHUT ‚Äì Dir. L√©onore Vanier ‚Äì Lead (comedy) ‚Äì Selected \"Prix Florent Image\"",
    "films.item3": "MASTERPROF ‚Äì Dir. Jef Yomby ‚Äì Opango ‚Äì Lead (comedy)",

    "tv.item1": "VINCI AUTOROUTE ‚Äì Dir. Charly ‚Äì Prod. Marie Gleyze & Sylvain Pouyet ‚Äì Lead",
    "tv.item2": "ENGIE Solutions ‚Äì Dir. 714 Prod ‚Äì Lead",

    "training.item1": "2025 ‚Äì \"Initiation to trance\" (Val√©rie De Dietrich) ‚Äî Systema (Laurent Joly) ‚Äî Coaching workshop (Fabrice Luneau) ‚Äî VHSS badge",
    "training.item2": "2024-25 ‚Äì Cours Florent: Year 3 (Jerzy Klsyk, Sandy Boizard, Sophie Lecarpentier) ‚Äî Mask (Khadija El Mahdi) ‚Äî Improv (David Garel) ‚Äî Casting (Emmanuelle Bourcy)",
    "training.item3": "2023-24 ‚Äì Cours Florent: Year 2 (Xavier Bazin)",
    "training.item4": "2022-23 ‚Äì Cours Florent: Year 1 (Olivier Augrond)",
    "training.item5": "2022 ‚Äì Engineering degree, National University of Singapore",

    "photos.epoque": "Period",
    "photos.innocence": "Innocence",
    "photos.fatale": "Femme fatale",
    "photos.malice": "Mischief",
    "photos.romantique": "Romantic",
    "photos.dynamique": "Dynamic",
    "photos.puissante": "Powerful",
    "photos.douceur": "Softness",
    "photos.heroine_romantique": "Romantic heroine",
    "photos.heroine_epoque": "Period romantic heroine",
    "photos.jeune_flic": "Young cop"
  }
};

/* ========= i18n : applique langue ========= */
function setLang(lang){
  localStorage.setItem('lang', lang);
  document.documentElement.setAttribute('lang', lang);

  // Textes simples
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const key = el.getAttribute('data-i18n');
    const text = I18N[lang]?.[key];
    if (typeof text === 'string') el.textContent = text;
  });

  // Attributs (ex: alt, aria-label) via data-i18n-attr="alt:key;aria-label:key2"
  document.querySelectorAll('[data-i18n-attr]').forEach(el=>{
    const defs = el.getAttribute('data-i18n-attr')
      .split(';').map(s=>s.trim()).filter(Boolean);
    defs.forEach(pair=>{
      const [attr, key] = pair.split(':').map(s=>s.trim());
      const val = I18N[lang]?.[key];
      if (attr && typeof val === 'string') el.setAttribute(attr, val);
    });
  });

  // Boutons FR/EN
  document.querySelectorAll('.lang-btn').forEach(btn=>{
    btn.setAttribute('aria-pressed', String(btn.dataset.lang === lang));
  });

  // Met √† jour le libell√© du toggle casting
  const list = document.getElementById('casting-list');
  const toggle = document.querySelector('.toggle-casting');
  if (list && toggle){
    const expanded = list.classList.contains('expanded');
    const tkey = expanded ? 'toggle.less' : 'toggle.more';
    toggle.textContent = I18N[lang][tkey] || toggle.textContent;
  }
}

/* ========= Casting : clamp + toggle ========= */
function initCastingClamp(){
  const list = document.getElementById('casting-list');
  if(!list) return;
  const rows = Array.from(list.querySelectorAll('.kv'));
  const toggle = document.querySelector('.toggle-casting');

  function apply(){
    const expanded = list.classList.contains('expanded');
    rows.forEach((row, i)=>{
      row.style.display = (expanded || i < 3) ? 'grid' : 'none';
    });
    const lang = localStorage.getItem('lang') || 'fr';
    toggle.textContent = I18N[lang]['toggle.'+(expanded?'less':'more')] || toggle.textContent;
  }

  if (toggle){
    toggle.addEventListener('click', (e)=>{
      e.preventDefault();
      list.classList.toggle('expanded');
      apply();
    });
  }
  apply();
}

/* ========= Lightbox ========= */
function initLightbox(){
  const links = Array.from(document.querySelectorAll('.gallery a'));
  if(!links.length) return;

  const lb = document.getElementById('lightbox');
  const img = document.getElementById('lb-img');
  const cap = document.getElementById('lb-caption');
  const btnPrev = lb.querySelector('.lb-prev');
  const btnNext = lb.querySelector('.lb-next');
  const btnClose = lb.querySelector('.lb-close');
  let idx = 0;

  const srcOf = (i)=> {
    const a = links[i];
    return a.getAttribute('href') || (a.querySelector('img') && a.querySelector('img').src);
  };
  const altOf = (i)=> {
    const im = links[i].querySelector('img');
    return (im && im.getAttribute('alt')) || '';
  };

  function open(i){ idx = i; update(); lb.classList.add('open'); lb.setAttribute('aria-hidden','false'); document.body.classList.add('lb-open'); }
  function close(){ lb.classList.remove('open'); lb.setAttribute('aria-hidden','true'); document.body.classList.remove('lb-open'); }
  function update(){ img.src = srcOf(idx); img.alt = altOf(idx); cap.textContent = img.alt || ''; }
  function next(){ idx = (idx + 1) % links.length; update(); }
  function prev(){ idx = (idx - 1 + links.length) % links.length; update(); }

  links.forEach((a,i)=>{
    a.addEventListener('click', (e)=>{ e.preventDefault(); open(i); });
  });
  btnNext.addEventListener('click', (e)=>{ e.stopPropagation(); next(); });
  btnPrev.addEventListener('click', (e)=>{ e.stopPropagation(); prev(); });
  btnClose.addEventListener('click', (e)=>{ e.stopPropagation(); close(); });

  document.addEventListener('keydown', (e)=>{
    if(!lb.classList.contains('open')) return;
    if(e.key === 'Escape') return close();
    if(e.key === 'ArrowRight') return next();
    if(e.key === 'ArrowLeft') return prev();
  });

  lb.addEventListener('click', (e)=>{
    if(e.target === lb){ close(); }
  });
}

/* ========= Init global ========= */
document.addEventListener('DOMContentLoaded', ()=>{
  // Ann√©e auto
  const yearEl = document.getElementById('year');
  if (yearEl) yearEl.textContent = new Date().getFullYear();

  // Langue initiale
  const saved = localStorage.getItem('lang') || 'fr';
  setLang(saved);

  // Boutons de langue
  document.querySelectorAll('.lang-btn').forEach(btn=>{
    btn.addEventListener('click', ()=> setLang(btn.dataset.lang));
  });

  // Modules
  initCastingClamp();
  initLightbox();
});
// Charge html2canvas si absent (fallback CDN)
function ensureHtml2Canvas() {
  return new Promise((resolve, reject) => {
    if (window.html2canvas) return resolve();
    const s = document.createElement('script');
    s.src = 'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js';
    s.onload = () => window.html2canvas ? resolve() : reject(new Error('html2canvas introuvable apr√®s chargement'));
    s.onerror = () => {
      const s2 = document.createElement('script');
      s2.src = 'https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js';
      s2.onload = () => window.html2canvas ? resolve() : reject(new Error('html2canvas introuvable (fallback)'));
      s2.onerror = () => reject(new Error('Impossible de charger html2canvas (tous les CDNs)'));
      document.head.appendChild(s2);
    };
    document.head.appendChild(s);
  });
}

// ====== Capture d'√©cran (remplacement complet) ======
(function initScreenshot(){
  const btn = document.getElementById('download-snap');
  if (!btn) return;

  btn.addEventListener('click', async () => {
    try {
      await ensureHtml2Canvas(); // üëà garantit la lib charg√©e

      const target = document.body; // ou document.querySelector('.container')
      const canvas = await html2canvas(target, {
        useCORS: true,
        scale: window.devicePixelRatio > 1 ? 2 : 1,
        windowWidth: document.documentElement.scrollWidth,
        windowHeight: document.documentElement.scrollHeight
      });

      const year = new Date().getFullYear();
      const filename = `CV artistique L√©onore Vanier - 06 79 10 75 93 - ${year}.png`;

      const link = document.createElement('a');
      link.download = filename;
      link.href = canvas.toDataURL('image/png');
      document.body.appendChild(link);
      link.click();
      link.remove();
    } catch (err) {
      console.error('Erreur capture:', err);
      alert("La capture n'a pas pu √™tre g√©n√©r√©e (chargement html2canvas).");
    }
  });
})();

